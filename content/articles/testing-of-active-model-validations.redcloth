-----
title: Тестирование своих валидаций для ActiveModel 
kind: article
created_at: 18 Sep 2011
-----

h1. Тестирование своих валидаций для ActiveModel

На днях я начал писать библиотеку для работы с банковскими картами. Одно из назначений - проверка номера карты и её срока действия.

Как писать свои валидаторы для Rails 3 описано в документации. А вот как их протестировать?

h2. Решение №1

Пишем класс для валидируемого объекта, описываем правила валидации, а в спеке задаем значение для атрибута и проверить на валидность и наличие нужной нам ошибки. 

<code>
</code>

А что, если нам нужно протестировать больше правил?

Тут возникают различные варианты, базирующиеся на этом решении. Те, которые возникли у меня - плохо пахнут. Я хочу, чтобы было красиво :)

h2. Решение №2

В тестах ActiveModel я нашел то, что искал:

<code>
  def hello
  end
</code>

Для каждого примера мы "прописываем валидации" и перед началом удаляем все валидации.

h2. Решение №3

Возникла ещё одна хорошая идея - использовать shoulda matchers. Тогда спеки будут выглядеть как-то так:

<code>
  def hello
  end
</code>

Вобщем, полезно осмотреться по сторонам.
